<div class="card">
  <div class="card-header bg-success text-white">
    {{ editMode ? 'Editar paciente' : 'Crear nuevo paciente' }}
  </div>

  <div class="card-body">
    <form [formGroup]="pacienteForm" (ngSubmit)="onSubmit()">
      <div *ngIf="error" class="alert alert-danger text-center">{{ error }}</div>

      <div class="row g-3">
        <div class="col-md-6">
          <label for="tipo_documento_id" class="form-label">Tipo de documento</label>
          <select id="tipo_documento_id" class="form-select" formControlName="tipo_documento_id" [ngClass]="{ 'is-invalid': isInvalid('tipo_documento_id') }">
            <option [ngValue]="null">Seleccione...</option>
            <option *ngFor="let tipo of tiposDocumento" [value]="tipo.id">{{ tipo.nombre }}</option>
          </select>
          <div class="invalid-feedback">Este campo es obligatorio.</div>
        </div>

        <div class="col-md-6">
          <label for="numero_documento" class="form-label">Número de documento</label>
          <input type="text" id="numero_documento" formControlName="numero_documento" class="form-control" [ngClass]="{ 'is-invalid': isInvalid('numero_documento') }" />
          <div class="invalid-feedback">Este campo es obligatorio.</div>
        </div>

        <div class="col-md-6">
          <label for="nombre1" class="form-label">Primer nombre</label>
          <input type="text" id="nombre1" formControlName="nombre1" class="form-control" [ngClass]="{ 'is-invalid': isInvalid('nombre1') }" />
          <div class="invalid-feedback">Este campo es obligatorio.</div>
        </div>

        <div class="col-md-6">
          <label for="nombre2" class="form-label">Segundo nombre</label>
          <input type="text" id="nombre2" formControlName="nombre2" class="form-control" />
        </div>

        <div class="col-md-6">
          <label for="apellido1" class="form-label">Primer apellido</label>
          <input type="text" id="apellido1" formControlName="apellido1" class="form-control" [ngClass]="{ 'is-invalid': isInvalid('apellido1') }" />
          <div class="invalid-feedback">Este campo es obligatorio.</div>
        </div>

        <div class="col-md-6">
          <label for="apellido2" class="form-label">Segundo apellido</label>
          <input type="text" id="apellido2" formControlName="apellido2" class="form-control" />
        </div>

        <div class="col-md-6">
          <label for="genero_id" class="form-label">Género</label>
          <select id="genero_id" class="form-select" formControlName="genero_id" [ngClass]="{ 'is-invalid': isInvalid('genero_id') }">
            <option [ngValue]="null">Seleccione...</option>
            <option *ngFor="let genero of generos" [value]="genero.id">{{ genero.nombre }}</option>
          </select>
          <div class="invalid-feedback">Este campo es obligatorio.</div>
        </div>

        <div class="col-md-6">
          <label for="departamento_id" class="form-label">Departamento</label>
          <select id="departamento_id" class="form-select" formControlName="departamento_id" [ngClass]="{ 'is-invalid': isInvalid('departamento_id') }">
            <option [ngValue]="null">Seleccione...</option>
            <option *ngFor="let dep of departamentos" [value]="dep.id">{{ dep.nombre }}</option>
          </select>
          <div class="invalid-feedback">Este campo es obligatorio.</div>
        </div>

        <div class="col-md-6">
          <label for="municipio_id" class="form-label">Municipio</label>
          <select id="municipio_id" class="form-select" formControlName="municipio_id" [ngClass]="{ 'is-invalid': isInvalid('municipio_id') }">
            <option [ngValue]="null">Seleccione...</option>
            <option *ngFor="let municipio of municipios" [value]="municipio.id">{{ municipio.nombre }}</option>
          </select>
          <div class="invalid-feedback">Este campo es obligatorio.</div>
        </div>

        <div class="col-md-6">
          <label for="correo" class="form-label">Correo electrónico</label>
          <input type="email" id="correo" formControlName="correo" class="form-control" [ngClass]="{ 'is-invalid': isInvalid('correo') }" />
          <div class="invalid-feedback">Ingresa un correo válido.</div>
        </div>
      </div>

      <div class="d-flex justify-content-between mt-4">
        <button type="button" class="btn btn-secondary" (click)="navigate()">Volver</button>
        <button type="submit" class="btn btn-success" [disabled]="pacienteForm.invalid || isLoading">
          <span *ngIf="!isLoading">{{ editMode ? 'Actualizar' : 'Guardar' }}</span>
          <span *ngIf="isLoading">
            <span class="spinner-border spinner-border-sm me-2"></span>
            {{ editMode ? 'Actualizando...' : 'Guardando...' }}
          </span>
        </button>
      </div>
    </form>
  </div>
</div>


<div *ngIf="isLoading" class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-white bg-opacity-75" style="z-index: 1050;">
  <div class="text-center">
    <div class="spinner-border text-success" style="width: 3rem; height: 3rem;" role="status"></div>
    <div class="mt-3 fs-5 fw-semibold text-success">Procesando...</div>
  </div>
</div>


